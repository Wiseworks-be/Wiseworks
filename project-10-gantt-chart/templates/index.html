<!-- templates/index.html -->
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Python & HTML Gantt Chart (Responsive)</title>
    <style>
        body { font-family: sans-serif; }

        /* --- NEW CSS FOR RESPONSIVENESS --- */

        /* 1. This is the outer container. It will be 100% of the page width.
           The 'overflow-x: auto' is the key: it adds a horizontal scrollbar
           ONLY if the content inside it is wider than the container itself. */
        #chart_container {
            width: 100%;
            overflow-x: auto;
            border: 1px solid #ddd; /* Optional: adds a nice border */
        }

        /* 2. This is the div where the chart is drawn. We give it a minimum width.
           When the browser window is wider than 800px, the chart fills the space.
           When the window gets narrower than 800px, this div stays 800px wide,
           and the scrollbar on '#chart_container' will appear. */
        #gantt_chart {
            width: 100%;
            min-width: 800px; /* Adjust this value to your liking */
            height: 500px; /* You can still control the height */
        }
    </style>
    <!-- Load the Google Charts library -->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <h1>Project Plan Gantt Chart</h1>
    <p>This chart is generated by Python (Flask) and rendered in the browser with Google Charts. Resize your browser window to see it adapt.</p>
    
    <!-- MODIFIED HTML: The chart div is now wrapped -->
    <div id="chart_container">
        <div id="gantt_chart"></div>
    </div>

    <!-- --- MODIFIED JAVASCRIPT FOR REDRAWING --- -->
    <script type="text/javascript">
        google.charts.load('current', {'packages':['gantt']});
        google.charts.setOnLoadCallback(initializeChart);

        // We declare these variables here so they are accessible by all functions.
        let chart;
        let dataTable;
        let options;

        function initializeChart() {
            // Create the chart instance and DataTable once.
            chart = new google.visualization.Gantt(document.getElementById('gantt_chart'));
            dataTable = new google.visualization.DataTable();

            // Define the columns for the DataTable
            dataTable.addColumn('string', 'Task ID');
            dataTable.addColumn('string', 'Task Name');
            dataTable.addColumn('date', 'Start Date');
            dataTable.addColumn('date', 'End Date');
            dataTable.addColumn('number', 'Duration');
            dataTable.addColumn('number', 'Percent Complete');
            dataTable.addColumn('string', 'Dependencies');

            // Define chart options (we can define them here now)
            options = {
                height: 500, // The height is now controlled by the CSS
                gantt: {
                    trackHeight: 30,
                    palette: [
                        { "color": "#5e97f6", "dark": "#2a62bc", "light": "#a7c5f9" },
                        { "color": "#db4437", "dark": "#a52714", "light": "#f4a199" },
                        { "color": "#f2a600", "dark": "#ee8100", "light": "#ffcf4d" },
                        { "color": "#0f9d58", "dark": "#0b8043", "light": "#a2d3b8" }
                    ],
                    arrow: {
                        angle: 100,
                        width: 2,
                        color: '#5f6368',
                        radius: 0
                    }
                }
            };
            
            // Fetch data and draw the chart for the first time
            fetchAndDrawChart();
            
            // Add a listener to redraw the chart whenever the window is resized
            window.addEventListener('resize', drawChart);
        }

        function fetchAndDrawChart() {
             fetch('/data')
                .then(response => response.json())
                .then(jsonData => {
                    const rows = jsonData.map(task => {
                        const [id, name, startISO, endISO, duration, percent, deps] = task;
                        const parseDate = (isoString) => {
                            if (!isoString) return null;
                            const parts = isoString.split('-').map(Number);
                            return new Date(parts[0], parts[1] - 1, parts[2]);
                        };
                        return [id, name, parseDate(startISO), parseDate(endISO), duration, percent, deps];
                    });
                    
                    // Add the data to our existing dataTable instance
                    dataTable.addRows(rows);
                    
                    // Now draw the chart
                    drawChart();
                })
                .catch(error => console.error('Error fetching or drawing chart:', error));
        }

        // This function is now just responsible for drawing, so we can call it on resize.
        function drawChart() {
            // Make sure we don't try to draw before the data is loaded
            if (dataTable.getNumberOfRows() > 0) {
                 chart.draw(dataTable, options);
            }
        }
    </script>
</body>
</html>